services:
  codex-node1:
    image: clustertest-nim-codex
    build:
      context: ../.
      dockerfile: docker/codex.Dockerfile
    ports:
      - 8080:8080
    environment:
      - CDX_API_PORT=8080
    volumes:
      - ./hostdatadir/node1:/datadir
    networks:
      - primary

  codex-node2:
    image: clustertest-nim-codex
    ports:
      - 8081:8081
    environment:
      - CDX_API_PORT=8081
    volumes:
      - ./hostdatadir/node2:/datadir
    depends_on:
      - codex-node1
    networks:
      - primary
      - secondary

  codex-node3:
    image: clustertest-nim-codex
    ports:
      - 8082:8082
    environment:
      - CDX_API_PORT=8082
    volumes:
      - ./hostdatadir/node3:/datadir
    depends_on:
      - codex-node1
    networks:
      - secondary

networks:
  primary:
    name: primary
  secondary:
    name: secondary
